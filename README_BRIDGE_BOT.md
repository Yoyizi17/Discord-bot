# 🌉 Discord跨服桥接机器人

实现服务器间的消息转发和跨服沟通，让不同服务器的用户可以无缝交流。

## ✨ 功能特色

### 🎯 **核心功能**
- **实时消息转发** - 监听指定频道，即时转发消息
- **原用户外观** - 使用原用户的头像和昵称发送消息
- **多格式支持** - 转发文本、图片、附件、嵌入消息
- **来源标识** - 显示消息来源的服务器和频道
- **多桥接支持** - 可配置多个不同的转发规则

### 🔧 **技术特点**
- **Webhook技术** - 使用Discord Webhook实现用户外观模拟
- **智能配置** - 自动创建和管理Webhook
- **数据持久化** - SQLite数据库存储配置和记录
- **实时监控** - 详细的转发统计和日志记录

## 🎛️ **命令功能**

### 👑 **管理员专用命令**

#### `/bridge_add` - 添加桥接配置
创建新的跨服消息转发规则。

**参数：**
- `桥接名称` - 配置的识别名称
- `源服务器ID` - 消息来源服务器的ID
- `源频道ID` - 监听消息的频道ID
- `目标服务器ID` - 转发目标服务器的ID
- `目标频道ID` - 转发消息的频道ID

**示例：**
```
/bridge_add 
桥接名称: 主服-分服聊天
源服务器ID: 123456789012345678
源频道ID: 987654321098765432
目标服务器ID: 111222333444555666
目标频道ID: 666555444333222111
```

#### `/bridge_list` - 查看桥接配置
显示所有已配置的跨服桥接规则和状态。

#### `/bridge_remove` - 删除桥接配置
删除指定名称的桥接配置。

#### `/bridge_stats` - 查看统计信息
显示转发统计、活跃桥接数量等信息。

#### `/bridge_help` - 查看帮助
显示使用指南和命令说明。

## 🚀 部署指南

### 1. 创建Discord机器人

1. 访问 [Discord开发者门户](https://discord.com/developers/applications)
2. 创建新应用，命名为"跨服桥接机器人"
3. 创建Bot并复制TOKEN
4. 设置必要权限：
   - ✅ **Send Messages** - 发送消息
   - ✅ **Read Message History** - 读取消息历史
   - ✅ **Use Slash Commands** - 使用斜杠命令
   - ✅ **Manage Webhooks** - 管理Webhook
   - ✅ **Embed Links** - 嵌入链接
   - ✅ **Attach Files** - 发送附件

### 2. 邀请机器人到所有相关服务器

**重要：** 机器人必须同时在源服务器和目标服务器中！

使用OAuth2 URL Generator生成邀请链接：
- **Scopes**: `bot`, `applications.commands`
- **权限**: 上述所有必要权限

### 3. 服务器部署

```bash
# 下载机器人代码
wget https://raw.githubusercontent.com/Yoyizi17/Discord-bot/main/cross_server_bridge_bot.py

# 或者使用git
git clone https://github.com/Yoyizi17/Discord-bot.git
cp Discord-bot/cross_server_bridge_bot.py ./

# 安装依赖
pip3 install discord.py aiohttp

# 配置TOKEN
nano cross_server_bridge_bot.py
# 替换 "你的跨服桥接机器人TOKEN" 为实际TOKEN

# 运行机器人
python3 cross_server_bridge_bot.py

# 后台运行
screen -S bridge-bot python3 cross_server_bridge_bot.py
# 按 Ctrl+A+D 退出screen
```

## 📋 使用流程

### 步骤1: 获取频道ID

**在Discord中启用开发者模式：**
1. Discord设置 → 高级 → 开发者模式 ✅

**获取服务器ID：**
1. 右键服务器图标 → 复制ID

**获取频道ID：**
1. 右键频道名称 → 复制ID

### 步骤2: 配置桥接

```
/bridge_add
桥接名称: 主服-分服
源服务器ID: [主服服务器ID]
源频道ID: [主服聊天频道ID]
目标服务器ID: [分服服务器ID]
目标频道ID: [分服聊天频道ID]
```

### 步骤3: 测试转发

1. 在源频道发送测试消息
2. 检查目标频道是否收到转发
3. 验证用户头像和昵称是否正确显示

### 步骤4: 管理桥接

```
/bridge_list    # 查看所有配置
/bridge_stats   # 查看转发统计
/bridge_remove  # 删除不需要的桥接
```

## 🔧 配置示例

### 单向桥接（A → B）
```
桥接名称: 公告转发
源服务器: 主服务器 (ID: 123...)
源频道: #公告频道 (ID: 456...)
目标服务器: 分服务器 (ID: 789...)
目标频道: #同步公告 (ID: 012...)
```

### 双向桥接（A ↔ B）
需要创建两个桥接配置：

**配置1: A → B**
```
桥接名称: 主到分
源服务器: 主服务器
源频道: #通用聊天
目标服务器: 分服务器
目标频道: #跨服聊天
```

**配置2: B → A**
```
桥接名称: 分到主
源服务器: 分服务器
源频道: #跨服聊天
目标服务器: 主服务器
目标频道: #通用聊天
```

### 多服集中（多个服务器 → 中心服务器）
```
桥接1: 服务器A → 中心服务器
桥接2: 服务器B → 中心服务器
桥接3: 服务器C → 中心服务器
```

## 🗄️ 数据存储

### bridge_configs 表（桥接配置）
- `bridge_name` - 桥接名称
- `source_guild_id` - 源服务器ID
- `source_channel_id` - 源频道ID
- `target_guild_id` - 目标服务器ID
- `target_channel_id` - 目标频道ID
- `webhook_url` - Webhook URL
- `is_enabled` - 是否启用

### forwarded_messages 表（转发记录）
- `bridge_name` - 所属桥接
- `original_message_id` - 原消息ID
- `forwarded_message_id` - 转发后消息ID
- `author_id` - 作者ID
- `author_name` - 作者名称
- `content` - 消息内容
- `timestamp` - 转发时间

## 💡 使用场景

### 🏢 **组织管理**
- **总部-分部沟通** - 不同地区团队的实时交流
- **部门协作** - 跨部门项目的信息同步
- **公告同步** - 重要消息同时发布到多个群组

### 🎮 **游戏社区**
- **多服联动** - 不同游戏服务器玩家交流
- **公会联盟** - 盟友公会间的战略讨论
- **活动通知** - 跨服活动信息同步

### 📚 **教育培训**
- **多班交流** - 不同班级学生的学习讨论
- **师生互动** - 教师在多个班级群中答疑
- **家长沟通** - 学校信息同步到家长群

### 🌐 **国际社区**
- **多语言频道** - 不同语言社区的信息交换
- **地区协调** - 全球团队的协作沟通
- **文化交流** - 促进不同地区用户互动

## ⚠️ 注意事项

### 🔒 **权限要求**
- 机器人必须在所有相关服务器中
- 需要在目标频道有创建Webhook的权限
- 确保机器人角色位置足够高

### 📋 **最佳实践**
- **清晰命名** - 使用描述性的桥接名称
- **权限控制** - 只有管理员能配置桥接
- **定期检查** - 监控转发状态和统计信息
- **避免循环** - 不要创建循环转发的配置

### 🚫 **避免问题**
- **不要双向桥接同一频道** - 会造成消息重复
- **注意消息量** - 高频转发可能触发限制
- **检查权限** - 确保所有必要权限已授予

## 🔧 故障排除

### 常见问题：

**1. 消息不转发**
- 检查机器人是否在两个服务器中
- 验证频道ID是否正确
- 确认机器人有必要权限

**2. Webhook创建失败**
- 检查管理Webhook权限
- 确认目标频道存在
- 验证机器人角色位置

**3. 用户外观不正确**
- 检查Webhook是否正常工作
- 验证用户头像URL有效性
- 确认用户昵称获取正确

## 📊 监控和维护

### 定期检查
```
/bridge_stats  # 查看转发统计
/bridge_list   # 检查配置状态
```

### 数据备份
```bash
# 备份配置数据库
cp bridge_config.db bridge_backup_$(date +%Y%m%d).db
```

### 日志监控
```bash
# 查看机器人运行日志
screen -r bridge-bot
```

## 🎉 效果展示

使用这个机器人后，你的用户将看到：

**在服务器A发送：**
```
张三: 大家好！今天天气不错呢
```

**在服务器B收到：**
```
张三: 大家好！今天天气不错呢

📍 来自: 服务器A #通用聊天
```

完全像是张三本人在服务器B发送的消息，包括头像和昵称！

这个机器人将彻底改变你的多服务器管理体验，让社区更加紧密连接！🌉✨
